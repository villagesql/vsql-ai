# Test Google provider (Gemini models) for vsql_ai extension

# Install extension
INSTALL EXTENSION vsql_ai;

# Test with invalid API key - should return NULL with error warning
SELECT LENGTH(vsql_ai.ai_prompt('google', 'gemini-2.5-flash', 'invalid_key_12345', 'Hello')) IS NULL AS invalid_key_returns_null;

# Test with real API key if GEMINI_API_KEY environment variable is set
if ($GEMINI_API_KEY) {
  --echo # Testing with real Google API key (key hidden from output)

  # Hide the API key from the result file
  --disable_query_log
  --eval SET @api_key = '$GEMINI_API_KEY'
  --enable_query_log

  # Simple prompt test - Gemini should respond with SUCCESS
  SELECT vsql_ai.ai_prompt('google', 'gemini-2.5-flash', @api_key, 'Say only the word: SUCCESS') LIKE '%SUCCESS%' AS contains_success;

  # Verify we got a non-empty response
  SELECT LENGTH(vsql_ai.ai_prompt('google', 'gemini-2.5-flash', @api_key, 'Reply with just: OK')) > 0 AS got_response;
}

if (!$GEMINI_API_KEY) {
  --echo # Skipping live API test - GEMINI_API_KEY not set
  --echo # To test with real API: export GEMINI_API_KEY=your-key
}

# Cleanup
UNINSTALL EXTENSION vsql_ai;
